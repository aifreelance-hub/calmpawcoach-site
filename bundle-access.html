<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Complete Pack Access ‚Äî CalmPaw Training Bundle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17779181109"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag("js", new Date());
    gtag("config", "AW-17779181109");
  </script>

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root{
      --bg:#fff7f0;
      --accent:#ffb86b;
      --accent-strong:#ff914d;
      --text-main:#3b2824;
      --text-soft:#8a6a63;
      --border-soft:#f3d9c4;
      --radius-lg:26px;
      --radius-md:18px;
      --radius-pill:999px;
      --shadow-soft:0 24px 60px rgba(210,145,110,0.32);
    }

    body{
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",system-ui,"Segoe UI",sans-serif;
      background:
        radial-gradient(circle at 5% 0%, #ffe0c0 0%, transparent 55%),
        radial-gradient(circle at 100% 0%, #ffd4d4 0%, transparent 55%),
        linear-gradient(180deg,#fff7f0 0%,#fff2e7 40%,#fff8f2 100%);
      color:var(--text-main);
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
    }

    a{text-decoration:none;color:inherit;}

    /* ===== Header ===== */

    header{
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter:blur(18px);
      background:linear-gradient(
        to bottom,
        rgba(255,248,240,0.98),
        rgba(255,248,240,0.9),
        rgba(255,248,240,0.8)
      );
      border-bottom:1px solid rgba(243,217,196,0.8);
    }

    .nav-inner{
      max-width:1120px;
      margin:0 auto;
      padding:10px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }

    .brand-logo-wrap{
      position:relative;
    }

    .brand-orbit{
      position:absolute;
      inset:-4px;
      border-radius:50%;
      background:conic-gradient(
        from 160deg,
        rgba(255,184,107,0.15),
        rgba(255,145,77,0.3),
        rgba(255,230,190,0.2),
        rgba(255,184,107,0.15)
      );
      filter:blur(4px);
      opacity:0.9;
    }

    .brand-logo{
      width:40px;
      height:40px;
      border-radius:18px;
      background:radial-gradient(circle at 20% 15%,#fff9f3 0%,#ffb86b 40%,#ff914d 84%);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:22px;
      box-shadow:0 16px 40px rgba(214,139,86,0.6);
      position:relative;
      z-index:1;
    }

    .brand-text-main{
      font-weight:750;
      letter-spacing:.03em;
      font-size:18px;
      white-space:nowrap;
    }

    .brand-text-sub{
      font-size:11px;
      color:var(--text-soft);
      white-space:nowrap;
    }

    .nav-links{
      display:flex;
      align-items:center;
      gap:16px;
      font-size:14px;
      color:var(--text-soft);
      flex:1;
      justify-content:center;
      min-width:0;
    }

    .nav-links a{
      padding:6px 11px;
      border-radius:999px;
      position:relative;
      overflow:hidden;
      transition:color .18s ease,transform .12s ease,background .18s ease;
    }

    .nav-links a:hover{
      color:var(--text-main);
      background:rgba(255,222,186,0.8);
      transform:translateY(-1px);
    }

    .nav-cta{
      display:flex;
      align-items:center;
      gap:8px;
      flex-shrink:0;
      margin-left:auto;
    }

    .btn-outline{
      padding:7px 14px;
      border-radius:var(--radius-pill);
      border:1px solid var(--border-soft);
      font-size:13px;
      background:#fff8f2;
      color:var(--text-soft);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
      transition:all .18s ease;
    }

    .btn-outline:hover{
      border-color:var(--accent);
      color:var(--text-main);
      box-shadow:0 14px 32px rgba(204,145,107,0.28);
      transform:translateY(-1px);
      background:#fffaf5;
    }

    .nav-login-emoji{font-size:14px;}

    .nav-auth{
      display:flex;
      align-items:center;
      gap:6px;
    }

    .nav-auth-email{
      max-width:160px;
      padding:5px 10px;
      border-radius:var(--radius-pill);
      background:rgba(255,250,244,0.95);
      border:1px solid rgba(243,217,196,0.9);
      font-size:12px;
      color:#6b4532;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .nav-auth-btn{
      border:none;
      background:transparent;
      font-size:11px;
      color:#b05825;
      padding:4px 7px;
      border-radius:999px;
      cursor:pointer;
      white-space:nowrap;
      transition:background .15s ease,color .15s ease;
    }

    .nav-auth-btn:hover{
      background:rgba(255,237,213,0.95);
      color:#7a3410;
    }

    @media(max-width:880px){
      .nav-links{display:none;}
      .nav-inner{align-items:flex-start;}
      .nav-cta{margin-left:0;}
    }

    @media(max-width:640px){
      .nav-inner{
        padding:8px 14px;
        gap:6px;
        flex-wrap:wrap;
        align-items:flex-start;
      }
      .brand{width:100%;}
      .brand-logo{width:34px;height:34px;font-size:20px;}
      .brand-text-main{font-size:16px;}
      .brand-text-sub{font-size:10px;}
      .nav-cta{
        width:100%;
        justify-content:flex-end;
        gap:6px;
      }
      .btn-outline{
        padding:6px 10px;
        font-size:12px;
      }
      .nav-auth-email{
        max-width:130px;
        font-size:11px;
      }
    }

    /* ===== Main ÂÜÖÂÆπ ===== */

    main{
      max-width:1120px;
      margin:0 auto;
      padding:24px 20px 40px;
    }

    .hero{
      margin-bottom:24px;
      border-radius:var(--radius-lg);
      background:rgba(255,246,238,0.96);
      border:1px solid rgba(243,217,196,0.9);
      padding:16px 16px 14px;
      box-shadow:var(--shadow-soft);
    }

    .hero-title{
      font-size:22px;
      margin-bottom:6px;
    }

    .hero-sub{
      font-size:13px;
      color:var(--text-soft);
      margin-bottom:8px;
      line-height:1.6;
      max-width:640px;
    }

    .hero-note{
      font-size:11px;
      color:#7b5847;
      background:rgba(255,233,205,0.95);
      padding:6px 10px;
      border-radius:var(--radius-pill);
      display:inline-block;
    }

    .plans-grid{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:16px;
      margin-top:20px;
      margin-bottom:26px;
    }

    @media(max-width:960px){
      .plans-grid{grid-template-columns:repeat(2,minmax(0,1fr));}
    }

    @media(max-width:640px){
      .plans-grid{grid-template-columns:minmax(0,1fr);}
    }

    .plan-card{
      border-radius:18px;
      background:#fffaf5;
      border:1px solid rgba(243,217,196,0.9);
      padding:12px;
      font-size:12px;
      color:var(--text-soft);
    }

    .plan-pill{
      font-size:10px;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(255,222,186,0.9);
      color:#6b4532;
      display:inline-block;
      margin-bottom:4px;
    }

    .plan-title{
      font-size:14px;
      font-weight:600;
      margin-bottom:4px;
      color:#8a4b25;
    }

    .plan-desc{
      font-size:12px;
      margin-bottom:6px;
    }

    .plan-link{
      font-size:11px;
      color:#b05825;
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    .plan-link span{font-size:13px;}

    .section{
      margin-bottom:24px;
    }

    .section h2{
      font-size:16px;
      margin-bottom:6px;
    }

    .section p{
      font-size:13px;
      color:var(--text-soft);
      margin-bottom:6px;
      line-height:1.6;
    }

    .bullets{
      font-size:13px;
      color:var(--text-soft);
      margin-left:16px;
    }

    .bullets li{margin-bottom:4px;}

    .highlight-box{
      border-radius:18px;
      background:rgba(255,247,238,0.96);
      border:1px solid rgba(243,217,196,0.9);
      padding:12px;
      font-size:12px;
      color:#7b5847;
    }

    /* ËÆøÈóÆÁä∂ÊÄÅÔºöÂ∞èËèäËä± + ÊàêÂäü / ÈîôËØØÊ†∑Âºè */
    .access-status-row{
      display:flex;
      align-items:flex-start;
      gap:10px;
    }
    .access-spinner{
      width:16px;
      height:16px;
      border-radius:999px;
      border:2px solid rgba(255,184,107,0.3);
      border-top-color:#ff914d;
      animation:access-spin .8s linear infinite;
      flex-shrink:0;
      margin-top:2px;
    }
    @keyframes access-spin{
      from{transform:rotate(0deg);}
      to{transform:rotate(360deg);}
    }
    .access-status-ok{
      background:rgba(209,250,229,0.96);
      border-color:rgba(52,211,153,0.7);
      color:#047857;
    }
    .access-status-error{
      background:rgba(254,242,242,0.96);
      border-color:rgba(248,113,113,0.7);
      color:#b91c1c;
    }

    /* ===== Footer ===== */

    footer{
      border-top:1px solid rgba(243,217,196,0.8);
      background:rgba(255,248,241,0.96);
      margin-top:10px;
    }

    .footer-inner{
      max-width:1120px;
      margin:0 auto;
      padding:12px 20px 16px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:space-between;
      font-size:11px;
      color:var(--text-soft);
    }

    .footer-links{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
    }

    .footer-links a:hover{
      color:#b05825;
    }

    @media(max-width:640px){
      .footer-inner{
        padding:10px 14px 14px;
        font-size:10px;
      }
      .footer-links{
        gap:10px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="nav-inner">
      <a href="index.html" class="brand">
        <div class="brand-logo-wrap">
          <div class="brand-orbit"></div>
          <div class="brand-logo">üêæ</div>
        </div>
        <div>
          <div class="brand-text-main">CalmPaw Coach</div>
          <div class="brand-text-sub">Gentle, realistic dog training</div>
        </div>
      </a>
      <nav class="nav-links">
        <a href="programs.html">Programs</a>
        <a href="bundle.html">Complete Pack</a>
        <a href="ai.html">Ask a Dog Trainer ‚Äî AI Unlimited</a>
      </nav>
      <div class="nav-cta">
        <!-- ÈªòËÆ§ÔºöÊú™ÁôªÂΩïÊó∂ÊòæÁ§∫ Log in -->
        <div id="nav-auth-area">
          <a class="btn-outline" href="auth.html?redirect=/bundle-access.html">
            <span class="nav-login-emoji">üîë</span> Log in
          </a>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- È°∂ÈÉ®Áä∂ÊÄÅÊèêÁ§∫ -->
    <div id="access-status" class="highlight-box" style="display:none;margin-bottom:16px;"></div>

    <!-- ÁúüÊ≠£ÂÜÖÂÆπÔºöÊúâ bundle ÊùÉÈôêÂêéÂÜçÂ±ïÁ§∫ -->
    <div id="paid-content" style="display:none;">
      <section class="hero">
        <h1 class="hero-title">You‚Äôve unlocked the CalmPaw Complete Pack</h1>
        <p class="hero-sub">
          Thank you for purchasing the full bundle. You now have lifetime access
          to the barking, separation anxiety and leash walking plans. Use the
          links below to jump straight into the plan you want to start with.
        </p>
        <div class="hero-note">
          Tip: bookmark this page ‚Äî it‚Äôs your central access hub for all three plans.
        </div>
      </section>

      <section>
        <div class="plans-grid">
          <div class="plan-card">
            <div class="plan-pill">Step 1 ¬∑ If noise is urgent</div>
            <div class="plan-title">Barking Plan ¬∑ 7 days</div>
            <div class="plan-desc">
              Begin here if neighbors, hallway sounds or door barking are your
              biggest stress. This plan builds a calm corner and quiet routine.
            </div>
            <a href="barking-access.html" class="plan-link">
              Open barking plan <span>‚Üí</span>
            </a>
          </div>

          <div class="plan-card">
            <div class="plan-pill">Step 1 ¬∑ If panic is urgent</div>
            <div class="plan-title">Separation Anxiety Plan ¬∑ 14 days</div>
            <div class="plan-desc">
              Start here if alone-time panic is the hardest part of your life with
              your dog. This plan builds safe, tiny absences step by step.
            </div>
            <a href="anxiety-access.html" class="plan-link">
              Open separation plan <span>‚Üí</span>
            </a>
          </div>

          <div class="plan-card">
            <div class="plan-pill">Step 1 ¬∑ If walks are the problem</div>
            <div class="plan-title">Leash Walking Plan ¬∑ 10 days</div>
            <div class="plan-desc">
              Choose this first if daily walks feel like a battle. This plan
              focuses on pulling, zig-zagging and over-excitement outside.
            </div>
            <a href="leash-access.html" class="plan-link">
              Open leash plan <span>‚Üí</span>
            </a>
          </div>
        </div>
      </section>

      <section class="section">
        <h2>How to combine the plans without overwhelm</h2>
        <p>You do not need to train everything at once. Here are two easy options:</p>
        <ul class="bullets">
          <li>
            <strong>Option A:</strong> Focus on one main plan first (for example,
            separation), then add short sessions from the others as you feel ready.
          </li>
          <li>
            <strong>Option B:</strong> Use one plan as your ‚Äúmain focus‚Äù and do
            very small, 5-minute sessions from a second plan 2‚Äì3 times per week.
          </li>
        </ul>
        <p style="margin-top:6px;">
          The right order is the one that reduces the most stress for your household
          right now. There is no ‚Äúwrong‚Äù order.
        </p>
      </section>

      <section class="section">
        <h2>Need a reset later?</h2>
        <p>
          You can come back to this page any time and re-open any of the three plans.
          You‚Äôre free to repeat plans after moves, life changes or new family members.
        </p>
      </section>
    </div>
  </main>

  <footer>
    <div class="footer-inner">
      <div>¬© <span id="year"></span> CalmPaw Coach. All rights reserved.</div>
      <div class="footer-links">
        <a href="refund.html">Refund policy</a>
        <a href="terms.html">Terms of service</a>
        <a href="privacy.html">Privacy policy</a>
        <a href="legal.html">Legal / Imprint</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const API_BASE = "https://calmpaw-auth.sophieinbg.workers.dev";

    // È°∂ÈÉ®ÁôªÂΩïÁä∂ÊÄÅ
    function hydrateNavAuth() {
      const area = document.getElementById("nav-auth-area");
      if (!area) return;

      function renderLoggedOut() {
        const redirect = window.location.pathname + window.location.search;
        area.innerHTML = `
          <a class="btn-outline" href="auth.html?redirect=${encodeURIComponent(redirect)}">
            <span class="nav-login-emoji">üîë</span> Log in
          </a>
        `;
      }

      const token = localStorage.getItem("calmpaw_token");
      const email = localStorage.getItem("calmpaw_email");

      if (!token) {
        renderLoggedOut();
        return;
      }

      fetch(API_BASE + "/auth/me", {
        headers: { "Authorization": "Bearer " + token }
      })
        .then(res => res.json().then(data => ({ ok: res.ok, data })))
        .then(({ ok, data }) => {
          if (!ok || !data.ok) {
            localStorage.removeItem("calmpaw_token");
            localStorage.removeItem("calmpaw_email");
            renderLoggedOut();
            return;
          }
          const showEmail = email || data.email || "Member";
          area.innerHTML = `
            <div class="nav-auth">
              <span class="nav-auth-email" title="${showEmail}">${showEmail}</span>
              <button class="nav-auth-btn" id="nav-switch-account">Switch</button>
              <button class="nav-auth-btn" id="nav-logout">Log out</button>
            </div>
          `;
          const switchBtn = document.getElementById("nav-switch-account");
          if (switchBtn) {
            switchBtn.addEventListener("click", () => {
              localStorage.removeItem("calmpaw_token");
              localStorage.removeItem("calmpaw_email");
              const redirect = window.location.pathname + window.location.search;
              window.location.href = "auth.html?redirect=" + encodeURIComponent(redirect);
            });
          }
          const logoutBtn = document.getElementById("nav-logout");
          if (logoutBtn) {
            logoutBtn.addEventListener("click", () => {
              localStorage.removeItem("calmpaw_token");
              localStorage.removeItem("calmpaw_email");
              window.location.href = "/index.html";
            });
          }
        })
        .catch(err => {
          console.error("auth hydrate error", err);
          renderLoggedOut();
        });
    }

    document.addEventListener("DOMContentLoaded", hydrateNavAuth);

    // ËÆøÈóÆÊéßÂà∂ÔºöÁôªÂΩï + Êã•Êúâ bundleÔºõÂ∏¶ËÆ¢ÂçïÂèÇÊï∞Êó∂ËΩÆËØ¢
    (function () {
      const token = localStorage.getItem("calmpaw_token");
      const statusBox = document.getElementById("access-status");
      const paidContent = document.getElementById("paid-content");

      const search = window.location.search || "";
      const hasOrderParams = /order_id=|transaction_id=/.test(search);
      const POLL_INTERVAL = 3000;
      const MAX_ATTEMPTS_AFTER_ORDER = 40; // ‚âà 2 ÂàÜÈíü
      const MAX_ATTEMPTS_NORMAL = 1;

      function ensureShown() {
        if (!statusBox) return;
        statusBox.style.display = "block";
      }

      function renderLoading() {
        if (!statusBox) return;
        ensureShown();
        statusBox.classList.remove("access-status-ok","access-status-error");
        statusBox.innerHTML = `
          <div class="access-status-row">
            <div class="access-spinner"></div>
            <div>
              Checking your bundle access‚Ä¶<br>
              ${hasOrderParams
                ? "We‚Äôre syncing your Digistore24 purchase. This can take up to 1‚Äì2 minutes. Please keep this page open."
                : "Please wait a moment."}
            </div>
          </div>
        `;
      }

      function renderOk() {
        if (!statusBox) return;
        ensureShown();
        statusBox.classList.remove("access-status-error");
        statusBox.classList.add("access-status-ok");
        statusBox.innerHTML = `
          <div class="access-status-row">
            <div>‚úÖ Access confirmed. You can use this page as your permanent hub for all three plans.</div>
          </div>
        `;
      }

      function renderNoAccessFinal() {
        if (!statusBox) return;
        ensureShown();
        statusBox.classList.remove("access-status-ok");
        statusBox.classList.add("access-status-error");
        statusBox.innerHTML = `
          <div class="access-status-row">
            <div>
              We can't find the Complete Pack on this account yet.<br>
              ${
                hasOrderParams
                  ? "If you just paid via Digistore24 and this page is still locked after a couple of minutes, please contact support with your payment email."
                  : "If you haven‚Äôt purchased the bundle yet, please go back to the product page and buy it with the same email you use to log in."
              }
            </div>
          </div>
        `;
      }

      function renderServerError() {
        if (!statusBox) return;
        ensureShown();
        statusBox.classList.remove("access-status-ok");
        statusBox.classList.add("access-status-error");
        statusBox.innerHTML = `
          <div class="access-status-row">
            <div>Server error. Please refresh this page or try again later.</div>
          </div>
        `;
      }

      function renderNeedLogin() {
        if (!statusBox) return;
        ensureShown();
        statusBox.classList.remove("access-status-ok");
        statusBox.classList.add("access-status-error");
        statusBox.innerHTML = `
          <div class="access-status-row">
            <div>Please log in with the same email you used to purchase the CalmPaw Complete Pack.</div>
          </div>
        `;
      }

      function goAuth() {
        const redirect = window.location.pathname + window.location.search;
        window.location.href = "/auth.html?redirect=" + encodeURIComponent(redirect);
      }

      if (!token) {
        renderNeedLogin();
        goAuth();
        return;
      }

      let attempts = 0;
      const maxAttempts = hasOrderParams ? MAX_ATTEMPTS_AFTER_ORDER : MAX_ATTEMPTS_NORMAL;

      function handleSuccessAccess() {
        if (paidContent) paidContent.style.display = "block";
        renderOk();

        // Ê∏ÖÁêÜ URL ÈáåÁöÑËÆ¢ÂçïÂèÇÊï∞
        if (hasOrderParams) {
          const cleanUrl = window.location.pathname;
          if (cleanUrl) {
            window.history.replaceState(null, "", cleanUrl);
          }
        }
      }

      function poll() {
        if (attempts >= maxAttempts) {
          renderNoAccessFinal();
          return;
        }
        attempts++;
        if (attempts === 1) {
          renderLoading();
        }

        fetch(API_BASE + "/auth/check-plan?slug=bundle", {
          method: "GET",
          headers: { Authorization: "Bearer " + token },
        })
          .then(res => res.json().then(data => ({ ok: res.ok, data })))
          .then(({ ok, data }) => {
            if (!ok) {
              localStorage.removeItem("calmpaw_token");
              localStorage.removeItem("calmpaw_email");
              renderNeedLogin();
              goAuth();
              return;
            }

            if (data && data.ok && data.access) {
              handleSuccessAccess();
              return;
            }

            if (attempts >= maxAttempts || !hasOrderParams) {
              renderNoAccessFinal();
            } else {
              setTimeout(poll, POLL_INTERVAL);
            }
          })
          .catch(() => {
            if (hasOrderParams && attempts < maxAttempts) {
              setTimeout(poll, POLL_INTERVAL);
            } else {
              renderServerError();
            }
          });
      }

      poll();
    })();
  </script>
</body>
</html>
